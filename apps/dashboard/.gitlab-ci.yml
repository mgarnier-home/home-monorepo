build dashboard amd64:
  stage: build apps
  script:
    - docker buildx build --platform linux/amd64 -t mgarnier11/dashboard -f apps/dashboard/docker/Dockerfile . --push

build dashboard arm64:
  stage: build apps
  tags:
    - arm64
  script:
    - docker buildx build --platform linux/arm64/v8 -t mgarnier11/dashboard -f apps/dashboard/docker/Dockerfile . --push

manifest dashboard:
  stage: manifest apps
  script:
    - docker manifest create mgarnier11/dashboard mgarnier11/dashboard:amd64 mgarnier11/dashboard:arm64
    - docker manifest push mgarnier11/dashboard

  # rules:
  #   - if: '$CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "push"'
  #     changes:
  #       - apps/dashboard/**/*
  #   - when: manual
