# image: docker:20

# include:
#   - 'apps/**/.gitlab-ci.yml'
#   - 'libs/**/.gitlab-ci.yml'

stages:
  - install dependencies
  - build

image: node:18

before_script:
  - corepack enable
  - corepack prepare pnpm@latest-8 --activate
  - pnpm config set store-dir .pnpm-store

cache:
  key:
    files:
      - pnpm-lock.yaml
  paths:
    - node_modules/
    - .pnpm-store/

# install dependencies:
#   stage: install dependencies
#   script:
#     - pnpm install --frozen-lockfile
# rules:
#   - if: '$CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "push"'
#     changes:
#       - 'docker/**'
#       - '**/package.json'
#       - 'pnpm-lock.yaml'
#       - 'libs/**/*'

build dashboard:
  stage: build
  script:
    - pnpm install --frozen-lockfile
    - npx nx build dashboard

  # rules:
  #   - if: '$CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "push"'
  #     changes:
  #       - apps/dashboard/**/*
  #   - when: manual
